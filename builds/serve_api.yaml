## Deploy a production environment using Nginx

- name: install nginx
  apt:
    name: nginx-full
    state: present
    force: yes
  become: true

- name: copy ini template
  template: src={{ corr_path }}/builds/corrapi.py.j2 dest={{ corr_path }}/builds/corrapi.py

- name: copy service template
  template: src={{ corr_path }}/builds/corrapi.service.j2 dest=/lib/systemd/system/corrapi.service
  become: true

- name: update systemd
  command: systemctl daemon-reload
  become: true

- name: run server
  service: name=corrapi state=restarted
  become: true

- name: copy nginx template
  template: src={{ corr_path }}/builds/nginx-api.j2 dest=/etc/nginx/sites-available/corrapi
  become: true

- name: link files for nginx
  file: src=/etc/nginx/sites-available/corrapi dest=/etc/nginx/sites-enabled/corrapi state=link
  become: true

- name:
  service: name=nginx state=restarted
  become: true

- name: kill servers
  service: name=corrapi state=stopped
  become: true
