## Deploy a production environment using Nginx

- name: install nginx
  apt:
    name: nginx-full
    state: present
    force: yes
  become: true

- name: copy ini template
  template: src={{ corr_path }}/builds/app_config.py.j2 dest={{ corr_path }}/builds/app_config.py

- name: copy service template
  template: src={{ corr_path }}/builds/app.service.j2 dest=/lib/systemd/system/app.service
  become: true

- name: update systemd
  command: systemctl daemon-reload
  become: true

- name: run server
  service: name=app state=restarted
  become: true

- name: copy nginx template
  template: src={{ corr_path }}/builds/nginx-app.j2 dest=/etc/nginx/sites-available/app
  become: true

- name: link files for nginx
  file: src=/etc/nginx/sites-available/app dest=/etc/nginx/sites-enabled/app state=link
  become: true

- name:
  service: name=nginx state=restarted
  become: true
